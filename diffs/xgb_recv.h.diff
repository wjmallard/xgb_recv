--- xgb_recv/xgb_recv.h	2010-04-16 13:44:32
+++ PySPEAD/src/_spead/include/buffer_socket.h	2026-02-03 20:34:20
@@ -1,16 +1,11 @@
-/* file: xgb_recv.h
- * auth: William Mallard
- * mail: wjm@berkeley.edu
- * date: 2008-12-22
- */
+#ifndef BUFFER_SOCKET_H
+#define BUFFER_SOCKET_H
 
-#ifndef _XGB_RECV_H_
-#define _XGB_RECV_H_
-
 #include <stdio.h>
 #include <stdlib.h>
 #include <unistd.h>
 #include <errno.h>
+#include <time.h>
 #include <string.h>
 #include <sys/types.h>
 #include <sys/socket.h>
@@ -28,41 +23,30 @@
 #include <sys/stat.h>
 #include <fcntl.h>
 
+#include "spead_packet.h"
 #include "ring_buffer.h"
-#include "debug_macros.h"
 
-/*
- * Useful typedefs
- */
-
 typedef int socket_t;
 typedef struct sockaddr_in SA_in;
 typedef struct sockaddr SA;
 
-/*
- * Structure Definitions
- */
-
 typedef struct {
-	RING_BUFFER *pkt_buffer;
-} NET_THREAD_ARGS;
+    RING_BUFFER *buf;
+    pthread_t net_thread, data_thread;
+    int (*callback)(SpeadPacket *, void *);
+    int run_threads;
+    int port;
+    void *userdata;
+} BufferSocket;
 
-typedef struct {
-	RING_BUFFER *pkt_buffer;
-} HDD_THREAD_ARGS;
-
-/*
- * Function Declarations
- */
-
-int receive_packets();
+int default_callback(SpeadPacket *pkt, void *userdata);
+void init_buffer_socket(BufferSocket *, size_t item_count);
+void free_buffer_socket(BufferSocket *);
+void set_callback(BufferSocket *, int (*cb_func)(SpeadPacket *, void *));
+int start(BufferSocket *bs, int port);
+int stop(BufferSocket *bs);
 void *net_thread_function(void *arg);
-void *hdd_thread_function(void *arg);
-socket_t setup_network_listener();
-int open_output_file(const char *path);
-void cleanup(int signal);
+void *data_thread_function(void *arg);
+socket_t setup_network_listener(short port);
 
-static uint32_t run_net_thread = 1;
-static uint32_t run_hdd_thread = 1;
-
-#endif /* _XGB_RECV_H_ */
+#endif
